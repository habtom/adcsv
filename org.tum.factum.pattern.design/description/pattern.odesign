<?xml version="1.0" encoding="UTF-8"?>
<description:Group xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:description="http://www.eclipse.org/sirius/description/1.1.0" xmlns:description_1="http://www.eclipse.org/sirius/diagram/description/1.1.0" xmlns:description_2="http://www.eclipse.org/sirius/table/description/1.1.0" xmlns:properties="http://www.eclipse.org/sirius/properties/1.0.0" xmlns:style="http://www.eclipse.org/sirius/diagram/description/style/1.1.0" xmlns:tool="http://www.eclipse.org/sirius/diagram/description/tool/1.1.0" xmlns:tool_1="http://www.eclipse.org/sirius/description/tool/1.1.0" xmlns:viewpoint-xtext="http://altran.com/general/integration/xtextsirius/model/viewpoint/1.0" name="pattern" version="12.0.0.2017041100">
  <ownedViewpoints name="PatternViewpoint" modelFileExtension="ecore xtext pmodel">
    <ownedRepresentations xsi:type="description_1:DiagramDescription" name="PatternDiagarm" label="PatternDiagram" domainClass="pattern::Pattern" enablePopupBars="true">
      <metamodel href="http://www.tum.org/factum/pattern/Pattern#/"/>
      <defaultLayer name="Default">
        <nodeMappings name="ComponentTypeNode" detailDescriptions="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='PatternDiagarm']/@defaultLayer/@toolSections.0/@ownedTools[name='createStatemachine']" semanticCandidatesExpression="feature:componentTypes" domainClass="pattern::ComponentType">
          <borderedNodeMappings name="InputPortNode" semanticCandidatesExpression="feature:inputPorts" domainClass="pattern::InputPort">
            <style xsi:type="style:EllipseNodeDescription" borderSizeComputationExpression="1" showIcon="false" labelAlignment="RIGHT" sizeComputationExpression="1" resizeKind="NSEW" horizontalDiameterComputationExpression="1.2" verticalDiameterComputationExpression="1.2">
              <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
            </style>
          </borderedNodeMappings>
          <borderedNodeMappings name="OutputPortNode" label="OutputPortNode" semanticCandidatesExpression="feature:outputPorts" domainClass="pattern::OutputPort">
            <style xsi:type="style:EllipseNodeDescription" borderSizeComputationExpression="1" showIcon="false" labelAlignment="RIGHT" sizeComputationExpression="1" resizeKind="NSEW" horizontalDiameterComputationExpression="1.2" verticalDiameterComputationExpression="1.2">
              <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            </style>
          </borderedNodeMappings>
          <style xsi:type="style:SquareDescription" iconPath="/runtimeFACTumS.zip_expanded/org.tum.factum.sample01.pattern/icons/Component.gif" labelPosition="node" resizeKind="NSEW" width="20" height="10">
            <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_gray']"/>
          </style>
        </nodeMappings>
        <edgeMappings name="interface" sourceMapping="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='PatternDiagarm']/@defaultLayer/@nodeMappings[name='ComponentTypeNode']/@borderedNodeMappings[name='OutputPortNode']" targetMapping="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='PatternDiagarm']/@defaultLayer/@nodeMappings[name='ComponentTypeNode']/@borderedNodeMappings[name='InputPortNode']" targetFinderExpression="feature:connects">
          <style lineStyle="dash">
            <strokeColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <centerLabelStyleDescription showIcon="false">
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            </centerLabelStyleDescription>
          </style>
        </edgeMappings>
        <toolSections name="patternSection">
          <ownedTools xsi:type="tool:NodeCreationDescription" name="createComponentType" label="ComponentType" nodeMappings="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='PatternDiagarm']/@defaultLayer/@nodeMappings[name='ComponentTypeNode']" iconPath="/runtimeFACTumS.zip_expanded/org.tum.factum.sample01.pattern/icons/Component.gif">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="pattern::ComponentType" referenceName="componentTypes">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'C'+container.componentTypes->filter(pattern::ComponentType)->size()"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="ctsname" valueExpression="aql:'C'+container.componentTypes->filter(pattern::ComponentType)->size()"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:NodeCreationDescription" name="createInputPort" label="Input Port" nodeMappings="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='PatternDiagarm']/@defaultLayer/@nodeMappings[name='ComponentTypeNode']/@borderedNodeMappings[name='InputPortNode']" iconPath="/runtimeFACTumS.zip_expanded/org.tum.factum.sample01.pattern/icons/Prt.gif">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="pattern::InputPort" referenceName="inputPorts">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'IP'+container.inputPorts->filter(pattern::InputPort)->size()"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:NodeCreationDescription" name="createOutputPort" label="Output Port" nodeMappings="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='PatternDiagarm']/@defaultLayer/@nodeMappings[name='ComponentTypeNode']/@borderedNodeMappings[name='OutputPortNode']" iconPath="/runtimeFACTumS.zip_expanded/org.tum.factum.sample01.pattern/icons/Prt.gif">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="pattern::OutputPort" referenceName="outputPorts">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'OP'+container.outputPorts->filter(pattern::OutputPort)->size()"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:EdgeCreationDescription" name="setInterface" label="Interface" edgeMappings="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='PatternDiagarm']/@defaultLayer/@edgeMappings[name='interface']">
            <sourceVariable name="source"/>
            <targetVariable name="target"/>
            <sourceViewVariable name="sourceView"/>
            <targetViewVariable name="targetView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:source">
                <subModelOperations xsi:type="tool_1:SetValue" featureName="connects" valueExpression="var:target"/>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:DiagramCreationDescription" name="createStatemachine" label="Statemachine Diagram" diagramDescription="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='StatemachineDiagram']">
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:self"/>
            </initialOperation>
            <containerViewVariable name="containerView"/>
            <representationNameVariable name="diagramName"/>
          </ownedTools>
        </toolSections>
      </defaultLayer>
    </ownedRepresentations>
    <ownedRepresentations xsi:type="description_1:DiagramDescription" name="StatemachineDiagram" initialisation="true" domainClass="pattern::ComponentType" enablePopupBars="true">
      <metamodel href="http://www.tum.org/factum/pattern/Pattern#/"/>
      <defaultLayer name="Default">
        <nodeMappings name="StateNode" deletionDescription="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='StatemachineDiagram']/@defaultLayer/@toolSections.0/@ownedTools[name='deleteState']" semanticCandidatesExpression="feature:states" domainClass="pattern::State">
          <style xsi:type="style:EllipseNodeDescription" labelSize="12" labelPosition="node" resizeKind="NSEW" horizontalDiameterComputationExpression="8" verticalDiameterComputationExpression="8">
            <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
          </style>
          <conditionnalStyles predicateExpression="aql:self.eContainer().initial.initialState.name == self.name">
            <style xsi:type="style:EllipseNodeDescription" labelSize="12" labelPosition="node" resizeKind="NSEW" horizontalDiameterComputationExpression="8" verticalDiameterComputationExpression="8">
              <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='blue']"/>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='dark_blue']"/>
            </style>
          </conditionnalStyles>
        </nodeMappings>
        <edgeMappings name="Transition" labelDirectEdit="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='StatemachineDiagram']/@defaultLayer/@toolSections.0/@ownedTools[name='Guard']" sourceMapping="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='StatemachineDiagram']/@defaultLayer/@nodeMappings[name='StateNode']" targetMapping="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='StatemachineDiagram']/@defaultLayer/@nodeMappings[name='StateNode']" targetFinderExpression="feature:transitionEnd" sourceFinderExpression="feature:transitionStart" domainClass="pattern::Transition" useDomainElement="true" reconnections="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='StatemachineDiagram']/@defaultLayer/@toolSections.0/@ownedTools[name='reconnectTarget'] //@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='StatemachineDiagram']/@defaultLayer/@toolSections.0/@ownedTools[name='reconnectSource']">
          <style sizeComputationExpression="2" routingStyle="manhattan">
            <strokeColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
            <centerLabelStyleDescription labelSize="12">
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            </centerLabelStyleDescription>
          </style>
        </edgeMappings>
        <toolSections name="Create">
          <ownedTools xsi:type="tool:NodeCreationDescription" name="createState" label="State" nodeMappings="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='StatemachineDiagram']/@defaultLayer/@nodeMappings[name='StateNode']" iconPath="/runtimeFACTumS.zip_expanded/org.tum.factum.sample01.pattern/icons/circle.png">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="pattern::State" referenceName="states">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'state'+container.states->filter(pattern::State)->size()"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:EdgeCreationDescription" name="setTransition" label="Transition" edgeMappings="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='StatemachineDiagram']/@defaultLayer/@edgeMappings[name='Transition']" iconPath="/runtimeFACTumS.zip_expanded/org.tum.factum.sample01.pattern/icons/left-arrow.png">
            <sourceVariable name="source"/>
            <targetVariable name="target"/>
            <sourceViewVariable name="sourceView"/>
            <targetViewVariable name="targetView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:source.eContainer()">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="pattern::Transition" referenceName="transitions">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="transitionStart" valueExpression="var:source"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="transitionEnd" valueExpression="var:target"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:DeleteElementDescription" name="deleteState" label="State">
            <element name="element"/>
            <elementView name="elementView"/>
            <containerView name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:self.eContainer()">
                <subModelOperations xsi:type="tool_1:For" expression="aql:self.transitions">
                  <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:self.transitionStart.name==element.name or self.transitionEnd.name==element.name">
                    <subModelOperations xsi:type="tool_1:RemoveElement"/>
                  </subModelOperations>
                </subModelOperations>
                <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:element">
                  <subModelOperations xsi:type="tool_1:RemoveElement"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:ReconnectEdgeDescription" name="reconnectTarget" label="Transition Target">
            <source name="source"/>
            <target name="target"/>
            <sourceView name="sourceView"/>
            <targetView name="targetView"/>
            <element name="element"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:source.eContainer()">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="pattern::Transition" referenceName="transitions">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="transitionEnd" valueExpression="var:target"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="transitionStart" valueExpression="aql:element.transitionStart"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="guardLeft" valueExpression="aql:element.guardLeft"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="guardRight" valueExpression="aql:element.guardRight"/>
                </subModelOperations>
                <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:element">
                  <subModelOperations xsi:type="tool_1:RemoveElement"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
            <edgeView name="edgeView"/>
          </ownedTools>
          <ownedTools xsi:type="tool:ReconnectEdgeDescription" name="reconnectSource" reconnectionKind="RECONNECT_SOURCE">
            <source name="source"/>
            <target name="target"/>
            <sourceView name="sourceView"/>
            <targetView name="targetView"/>
            <element name="element"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:source.eContainer()">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="pattern::Transition" referenceName="transitions">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="transitionEnd" valueExpression="aql:element.transitionEnd"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="transitionStart" valueExpression="var:target"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="guardLeft" valueExpression="aql:element.guardLeft"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="guardRight" valueExpression="aql:element.guardRight"/>
                </subModelOperations>
                <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:element">
                  <subModelOperations xsi:type="tool_1:RemoveElement"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
            <edgeView name="edgeView"/>
          </ownedTools>
          <ownedTools xsi:type="viewpoint-xtext:XtextEdgeLabelDirectEditModelDescription" name="Guard" forceRefresh="true" inputLabelExpression="aql:self" injectorId="org.tum.factum.pattern.ui.contentassist.languageInjectorId" multiLine="true">
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:SetValue" valueExpression="var:newValue"/>
            </initialOperation>
          </ownedTools>
        </toolSections>
      </defaultLayer>
    </ownedRepresentations>
    <ownedRepresentations xsi:type="description_2:EditionTableDescription" name="table" titleExpression="Variable" initialisation="true" domainClass="pattern::ComponentType">
      <metamodel href="http://www.tum.org/factum/pattern/Pattern#/"/>
      <ownedLineMappings name="variablesRow" domainClass="pattern::FsmVariable" headerLabelExpression="DT variable">
        <defaultForeground labelSize="15">
          <foreGroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
        </defaultForeground>
        <defaultBackground>
          <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
        </defaultBackground>
      </ownedLineMappings>
      <ownedCreateLine name="new DataTypeVariable" precondition="aql:true" forceRefresh="true" mapping="//@ownedViewpoints[name='PatternViewpoint']/@ownedRepresentations[name='table']/@ownedLineMappings[name='variablesRow']">
        <variables name="root" documentation="The semantic root element of the table."/>
        <variables name="element" documentation="The semantic currently edited element."/>
        <variables name="container" documentation="The semantic element corresponding to the view container."/>
        <firstModelOperation xsi:type="tool_1:ChangeContext" browseExpression="aql:container">
          <subModelOperations xsi:type="tool_1:CreateInstance" typeName="pattern::FsmVariable" referenceName="fsmVars">
            <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'var'+container.fsmVars->filter(pattern::FsmVariable)->size()"/>
            <subModelOperations xsi:type="tool_1:SetValue" featureName="varSortType" valueExpression="aql:container.eContainer().dtSpec.mapSorts.sortName->filter(pattern::Sort)->first()"/>
          </subModelOperations>
        </firstModelOperation>
      </ownedCreateLine>
      <ownedColumnMappings name="nameColumn" headerLabelExpression="Name" featureName="name" labelExpression="aql:self.name"/>
      <ownedColumnMappings name="sortColumn" headerLabelExpression="Sort" featureName="varSortType" labelExpression="aql:self.varSortType.name"/>
    </ownedRepresentations>
    <ownedJavaExtensions qualifiedClassName="org.tum.factum.pattern.design.Services"/>
  </ownedViewpoints>
  <extensions xsi:type="properties:ViewExtensionDescription" name="Properties">
    <categories name="Default Category">
      <pages name="pageState" label="State Page" labelExpression="Page" domainClass="pattern::State" semanticCandidateExpression="var:self" groups="//@extensions.0/@categories.0/@groups.0"/>
      <pages name="pageTranstion" label="Transition Page" labelExpression="Page" domainClass="pattern.Transition" groups="//@extensions.0/@categories.0/@groups.1"/>
      <groups name="propertyState" label="State" labelExpression="Group" domainClass="pattern::State" semanticCandidateExpression="var:self">
        <controls xsi:type="properties:CheckboxDescription" name="Initial State" labelExpression="Initial State" helpExpression="If this box is checked the selected state is the inital state of the statemachine" isEnabledExpression="aql:true" valueExpression="aql:self.eContainer().initial.initialState.name = self.name">
          <initialOperation>
            <firstModelOperations xsi:type="tool_1:Let" valueExpression="aql:self">
              <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:self">
                <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:newValue = true">
                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:self.eContainer().initial">
                    <subModelOperations xsi:type="tool_1:SetValue" featureName="initialState" valueExpression="aql:instance"/>
                  </subModelOperations>
                </subModelOperations>
                <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:newValue = false">
                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:self.eContainer().initial">
                    <subModelOperations xsi:type="tool_1:Unset" featureName="initialState" elementExpression="aql:instance"/>
                  </subModelOperations>
                </subModelOperations>
              </subModelOperations>
            </firstModelOperations>
          </initialOperation>
        </controls>
        <controls xsi:type="properties:TextDescription" name="Name" labelExpression="Name:" helpExpression="Edit the name of a state" isEnabledExpression="aql:true" valueExpression="aql:self.name">
          <initialOperation>
            <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:self">
              <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="var:newValue"/>
            </firstModelOperations>
          </initialOperation>
        </controls>
      </groups>
      <groups name="propertyTransition" label="Transition" labelExpression="Group" domainClass="pattern.Transition" semanticCandidateExpression="aql:self">
        <controls xsi:type="properties:LabelDescription" name="labelTransitionStart" label="Transition Start" labelExpression="from:" isEnabledExpression="aql:true" valueExpression="aql:self.transitionStart.name"/>
        <controls xsi:type="properties:LabelDescription" name="labelTransitionEnd" label="Transition End" labelExpression="to:" isEnabledExpression="aql:true" valueExpression="aql:self.transitionEnd.name"/>
      </groups>
    </categories>
  </extensions>
</description:Group>
